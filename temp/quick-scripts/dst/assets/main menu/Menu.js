
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/main menu/Menu.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '04525pyYBlN26SWawaUF3dA', 'Menu');
// main menu/Menu.js

"use strict";

var i18n = require('i18n');

var SceneList = require('SceneList');

var TipsManager = require('TipsManager');

var MainScene = 'TestList.fire';
cc.Class({
  "extends": cc.Component,
  properties: {
    text: cc.Label,
    readme: cc.ScrollView,
    btnInfo: cc.Button,
    btnBack: cc.Button,
    testList: cc.ScrollView,
    uiCamera: cc.Camera,
    sceneTitle: cc.Label,
    searchBlock: cc.Node
  },
  onLoad: function onLoad() {
    this._isLoadingScene = false;
    this.showDebugDraw = false;
    cc.game.addPersistRootNode(this.node);
    this.currentSceneUrl = MainScene;
    this.contentPos = null;
    this.btnBack.node.active = false;
    this.loadInstruction(this.currentSceneUrl);
    this.storage = this.node.getComponent('StorageUtil'); // keep the search scene list res

    cc.game.addPersistRootNode(this.searchBlock);
    cc.game.addPersistRootNode(this.testList.node);

    if (this.testList && this.testList.content) {
      // in main scene
      this.sceneList = this.testList.content.getComponent(SceneList);
      this.sceneList.init(this);
    }

    if (typeof cocosAnalytics !== 'undefined' && cocosAnalytics.isInited && cocosAnalytics.isInited()) {
      // Cocos Analytics service, to learn more please visit:
      // https://analytics.cocos.com/docs/
      cocosAnalytics.CAEvent.onEvent({
        eventName: "打开范例"
      });
    }

    cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, this._onSceneLaunched, this);
    var url = this.storage.getCurrentScene();

    if (url) {
      this.loadScene(url);
    }
  },
  _onSceneLaunched: function _onSceneLaunched() {
    var cameras = cc.Camera.cameras;

    for (var i = 0, l = cameras.length; i < l; i++) {
      var camera = cameras[i];

      if (camera === this.uiCamera) {
        camera.cullingMask = 1 << this.node.groupIndex;
      } else {
        camera.cullingMask = camera.cullingMask & ~(1 << this.node.groupIndex);
      }
    }
  },
  backToList: function backToList() {
    this.loadScene(MainScene);
  },
  loadScene: function loadScene(url) {
    if (this._isLoadingScene) {
      return;
    }

    var result = cc.director.loadScene(url, this.onLoadSceneFinish.bind(this));

    if (!result) {
      this.storage.setCurrentScene('');
      return;
    }

    this._isLoadingScene = true;
    this.showReadme(null, false);
    this.contentPos = this.testList.getContentPosition();
    this.currentSceneUrl = url;

    if (typeof cocosAnalytics !== 'undefined' && cocosAnalytics.isInited && cocosAnalytics.isInited()) {
      // Cocos Analytics service, to learn more please visit:
      // https://analytics.cocos.com/docs/
      cocosAnalytics.CALevels.begin({
        level: url
      });
    }
  },
  onLoadSceneFinish: function onLoadSceneFinish() {
    var url = this.currentSceneUrl;
    this.loadInstruction(url); // record the last close scene 

    this.storage.setCurrentScene(url);
    this.testList.node.active = false;
    var isMenu = url.endsWith(MainScene);
    this.btnBack.node.active = this.sceneTitle.node.active = !isMenu;
    this.testList.node.active = isMenu;

    if (isMenu) {
      if (this.contentPos) {
        this.testList.setContentPosition(this.contentPos);
      }
    } else {
      this.sceneTitle.string = url.replace('db://assets/cases/', '');
    }

    this._isLoadingScene = false;
  },
  _getAdjacentScenes: function _getAdjacentScenes() {
    var _this = this;

    var res = {
      next: '',
      prev: ''
    };
    var sceneList = this.sceneList.sceneList;

    function findAvailableScene(startIndex, step) {
      for (var i = startIndex; 0 <= i && i < sceneList.length; i += step) {
        var url = sceneList[i].url;

        if (url) {
          var sceneName = cc.path.basename(url, '.fire');
          var available = TipsManager.hasSupport(sceneName, true);

          if (available) {
            return url;
          }
        }
      }

      return MainScene;
    }

    if (this.currentSceneUrl.endsWith(MainScene)) {
      res.next = findAvailableScene(0, 1);
      res.prev = findAvailableScene(sceneList.length - 1, -1);
    } else {
      // findIndex
      var i = -1;
      sceneList.some(function (item, index) {
        if (item.url === _this.currentSceneUrl) {
          i = index;
          return true;
        }

        return false;
      });

      if (i !== -1) {
        res.next = findAvailableScene(i + 1, 1);
        res.prev = findAvailableScene(i - 1, -1);
      }
    }

    return res;
  },
  nextScene: function nextScene() {
    var _this$_getAdjacentSce = this._getAdjacentScenes(),
        next = _this$_getAdjacentSce.next;

    if (next) {
      this.loadScene(next);
    }
  },
  prevScene: function prevScene() {
    var _this$_getAdjacentSce2 = this._getAdjacentScenes(),
        prev = _this$_getAdjacentSce2.prev;

    if (prev) {
      this.loadScene(prev);
    }
  },
  loadInstruction: function loadInstruction(url) {
    var self = this;
    var urlArr = url.split('/');
    var fileName = urlArr[urlArr.length - 1].replace('.fire', '');
    cc.resources.load('readme/' + fileName, cc.TextAsset, function (err, asset) {
      if (err) {
        self.text.string = i18n.t("scripts/Global/Menu.js.1");
        return;
      }

      self.text.string = asset.text;
    });
  },
  showReadme: function showReadme(event, active) {
    if (active === undefined) {
      active = !this.readme.node.active;
    }

    this.readme.node.active = active;

    if (active) {
      this.readme.scrollToTop();
    } // en: fix Collider DebugDraw always displayed on top of the problem.
    // zh：解决 Collider DebugDraw 一直显示在最上层的问题。


    var enabledDebugDraw = cc.director.getCollisionManager().enabledDebugDraw;

    if (this.readme.node.active) {
      this.showDebugDraw = enabledDebugDraw;
      cc.director.getCollisionManager().enabledDebugDraw = false;
    } else {
      cc.director.getCollisionManager().enabledDebugDraw = this.showDebugDraw;
    } // en: fix Video Player always displayed on top of the problem.
    // zh：修复 Video Player 一直显示在最上层的问题。


    var videoPlayer = cc.find('Canvas/VideoPlayer');

    if (videoPlayer) {
      videoPlayer.active = !this.readme.node.active;
    }
  },
  restart: function restart() {
    cc.game.restart();
  },
  gc: function gc() {
    cc.sys.garbageCollect();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluIG1lbnUvTWVudS5qcyJdLCJuYW1lcyI6WyJpMThuIiwicmVxdWlyZSIsIlNjZW5lTGlzdCIsIlRpcHNNYW5hZ2VyIiwiTWFpblNjZW5lIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJ0ZXh0IiwiTGFiZWwiLCJyZWFkbWUiLCJTY3JvbGxWaWV3IiwiYnRuSW5mbyIsIkJ1dHRvbiIsImJ0bkJhY2siLCJ0ZXN0TGlzdCIsInVpQ2FtZXJhIiwiQ2FtZXJhIiwic2NlbmVUaXRsZSIsInNlYXJjaEJsb2NrIiwiTm9kZSIsIm9uTG9hZCIsIl9pc0xvYWRpbmdTY2VuZSIsInNob3dEZWJ1Z0RyYXciLCJnYW1lIiwiYWRkUGVyc2lzdFJvb3ROb2RlIiwibm9kZSIsImN1cnJlbnRTY2VuZVVybCIsImNvbnRlbnRQb3MiLCJhY3RpdmUiLCJsb2FkSW5zdHJ1Y3Rpb24iLCJzdG9yYWdlIiwiZ2V0Q29tcG9uZW50IiwiY29udGVudCIsInNjZW5lTGlzdCIsImluaXQiLCJjb2Nvc0FuYWx5dGljcyIsImlzSW5pdGVkIiwiQ0FFdmVudCIsIm9uRXZlbnQiLCJldmVudE5hbWUiLCJkaXJlY3RvciIsIm9uIiwiRGlyZWN0b3IiLCJFVkVOVF9BRlRFUl9TQ0VORV9MQVVOQ0giLCJfb25TY2VuZUxhdW5jaGVkIiwidXJsIiwiZ2V0Q3VycmVudFNjZW5lIiwibG9hZFNjZW5lIiwiY2FtZXJhcyIsImkiLCJsIiwibGVuZ3RoIiwiY2FtZXJhIiwiY3VsbGluZ01hc2siLCJncm91cEluZGV4IiwiYmFja1RvTGlzdCIsInJlc3VsdCIsIm9uTG9hZFNjZW5lRmluaXNoIiwiYmluZCIsInNldEN1cnJlbnRTY2VuZSIsInNob3dSZWFkbWUiLCJnZXRDb250ZW50UG9zaXRpb24iLCJDQUxldmVscyIsImJlZ2luIiwibGV2ZWwiLCJpc01lbnUiLCJlbmRzV2l0aCIsInNldENvbnRlbnRQb3NpdGlvbiIsInN0cmluZyIsInJlcGxhY2UiLCJfZ2V0QWRqYWNlbnRTY2VuZXMiLCJyZXMiLCJuZXh0IiwicHJldiIsImZpbmRBdmFpbGFibGVTY2VuZSIsInN0YXJ0SW5kZXgiLCJzdGVwIiwic2NlbmVOYW1lIiwicGF0aCIsImJhc2VuYW1lIiwiYXZhaWxhYmxlIiwiaGFzU3VwcG9ydCIsInNvbWUiLCJpdGVtIiwiaW5kZXgiLCJuZXh0U2NlbmUiLCJwcmV2U2NlbmUiLCJzZWxmIiwidXJsQXJyIiwic3BsaXQiLCJmaWxlTmFtZSIsInJlc291cmNlcyIsImxvYWQiLCJUZXh0QXNzZXQiLCJlcnIiLCJhc3NldCIsInQiLCJldmVudCIsInVuZGVmaW5lZCIsInNjcm9sbFRvVG9wIiwiZW5hYmxlZERlYnVnRHJhdyIsImdldENvbGxpc2lvbk1hbmFnZXIiLCJ2aWRlb1BsYXllciIsImZpbmQiLCJyZXN0YXJ0IiwiZ2MiLCJzeXMiLCJnYXJiYWdlQ29sbGVjdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLElBQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsSUFBTUUsV0FBVyxHQUFHRixPQUFPLENBQUMsYUFBRCxDQUEzQjs7QUFFQSxJQUFNRyxTQUFTLEdBQUcsZUFBbEI7QUFFQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7RUFDTCxXQUFTRCxFQUFFLENBQUNFLFNBRFA7RUFHTEMsVUFBVSxFQUFFO0lBQ1JDLElBQUksRUFBRUosRUFBRSxDQUFDSyxLQUREO0lBRVJDLE1BQU0sRUFBRU4sRUFBRSxDQUFDTyxVQUZIO0lBR1JDLE9BQU8sRUFBRVIsRUFBRSxDQUFDUyxNQUhKO0lBSVJDLE9BQU8sRUFBRVYsRUFBRSxDQUFDUyxNQUpKO0lBS1JFLFFBQVEsRUFBRVgsRUFBRSxDQUFDTyxVQUxMO0lBTVJLLFFBQVEsRUFBRVosRUFBRSxDQUFDYSxNQU5MO0lBT1JDLFVBQVUsRUFBRWQsRUFBRSxDQUFDSyxLQVBQO0lBUVJVLFdBQVcsRUFB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LElBQVosQ0FBaUJHLE1BQXJCLEVBQTZCO01BQ3pCLEtBQUtOLGFBQUwsR0FBcUI4RSxnQkFBckI7TUFDQWpHLEVBQUUsQ0FBQ3FDLFFBQUgsQ0FBWTZELG1CQUFaLEdBQWtDRCxnQkFBbEMsR0FBcUQsS0FBckQ7SUFDSCxDQUhELE1BSUs7TUFDRGpHLEVBQUUsQ0FBQ3FDLFFBQUgsQ0FBWTZELG1CQUFaLEdBQWtDRCxnQkFBbEMsR0FBcUQsS0FBSzlFLGFBQTFEO0lBQ0gsQ0FuQmdDLENBcUJqQztJQUNBOzs7SUFDQSxJQUFJZ0YsV0FBVyxHQUFHbkcsRUFBRSxDQUFDb0csSUFBSCxDQUFRLG9CQUFSLENBQWxCOztJQUNBLElBQUlELFdBQUosRUFBaUI7TUFDYkEsV0FBVyxDQUFDMUUsTUFBWixHQUFxQixDQUFDLEtBQUtuQixNQUFMLENBQVlnQixJQUFaLENBQWlCRyxNQUF2QztJQUNIO0VBQ0osQ0FuTkk7RUFxTkw0RSxPQXJOSyxxQkFxTk07SUFDUHJHLEVBQUUsQ0FBQ29CLElBQUgsQ0FBUWlGLE9BQVI7RUFDSCxDQXZOSTtFQXlOTEMsRUF6TkssZ0JBeU5DO0lBQ0Z0RyxFQUFFLENBQUN1RyxHQUFILENBQU9DLGNBQVA7RUFDSDtBQTNOSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBpMThuID0gcmVxdWlyZSgnaTE4bicpO1xuY29uc3QgU2NlbmVMaXN0ID0gcmVxdWlyZSgnU2NlbmVMaXN0Jyk7XG5jb25zdCBUaXBzTWFuYWdlciA9IHJlcXVpcmUoJ1RpcHNNYW5hZ2VyJyk7XG5cbmNvbnN0IE1haW5TY2VuZSA9ICdUZXN0TGlzdC5maXJlJztcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdGV4dDogY2MuTGFiZWwsXG4gICAgICAgIHJlYWRtZTogY2MuU2Nyb2xsVmlldyxcbiAgICAgICAgYnRuSW5mbzogY2MuQnV0dG9uLFxuICAgICAgICBidG5CYWNrOiBjYy5CdXR0b24sXG4gICAgICAgIHRlc3RMaXN0OiBjYy5TY3JvbGxWaWV3LFxuICAgICAgICB1aUNhbWVyYTogY2MuQ2FtZXJhLFxuICAgICAgICBzY2VuZVRpdGxlOiBjYy5MYWJlbCxcbiAgICAgICAgc2VhcmNoQmxvY2s6IGNjLk5vZGVcbiAgICB9LFxuXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2lzTG9hZGluZ1NjZW5lID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd0RlYnVnRHJhdyA9IGZhbHNlO1xuICAgICAgICBjYy5nYW1lLmFkZFBlcnNpc3RSb290Tm9kZSh0aGlzLm5vZGUpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZVVybCA9IE1haW5TY2VuZTtcbiAgICAgICAgdGhpcy5jb250ZW50UG9zID0gbnVsbDtcbiAgICAgICAgdGhpcy5idG5CYWNrLm5vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZEluc3RydWN0aW9uKHRoaXMuY3VycmVudFNjZW5lVXJsKTtcblxuICAgICAgICB0aGlzLnN0b3JhZ2UgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KCdTdG9yYWdlVXRpbCcpO1xuICAgICAgICAvLyBrZWVwIHRoZSBzZWFyY2ggc2NlbmUgbGlzdCByZXNcbiAgICAgICAgY2MuZ2FtZS5hZGRQZXJzaXN0Um9vdE5vZGUodGhpcy5zZWFyY2hCbG9jayk7XG4gICAgICAgIGNjLmdhbWUuYWRkUGVyc2lzdFJvb3ROb2RlKHRoaXMudGVzdExpc3Qubm9kZSk7XG4gICAgICAgIGlmICh0aGlzLnRlc3RMaXN0ICYmIHRoaXMudGVzdExpc3QuY29udGVudCkge1xuICAgICAgICAgICAgLy8gaW4gbWFpbiBzY2VuZVxuICAgICAgICAgICAgdGhpcy5zY2VuZUxpc3QgPSB0aGlzLnRlc3RMaXN0LmNvbnRlbnQuZ2V0Q29tcG9uZW50KFNjZW5lTGlzdCk7XG4gICAgICAgICAgICB0aGlzLnNjZW5lTGlzdC5pbml0KHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY29jb3NBbmFseXRpY3MgIT09ICd1bmRlZmluZWQnICYmIGNvY29zQW5hbHl0aWNzLmlzSW5pdGVkICYmIGNvY29zQW5hbHl0aWNzLmlzSW5pdGVkKCkpIHtcbiAgICAgICAgICAgIC8vIENvY29zIEFuYWx5dGljcyBzZXJ2aWNlLCB0byBsZWFybiBtb3JlIHBsZWFzZSB2aXNpdDpcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vYW5hbHl0aWNzLmNvY29zLmNvbS9kb2NzL1xuICAgICAgICAgICAgY29jb3NBbmFseXRpY3MuQ0FFdmVudC5vbkV2ZW50KHtcbiAgICAgICAgICAgICAgICBldmVudE5hbWU6IFwi5omT5byA6IyD5L6LXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY2MuZGlyZWN0b3Iub24oY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfU0NFTkVfTEFVTkNILCB0aGlzLl9vblNjZW5lTGF1bmNoZWQsIHRoaXMpO1xuXG4gICAgICAgIGxldCB1cmwgPSB0aGlzLnN0b3JhZ2UuZ2V0Q3VycmVudFNjZW5lKCk7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFNjZW5lKHVybCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX29uU2NlbmVMYXVuY2hlZCAoKSB7XG4gICAgICAgIGxldCBjYW1lcmFzID0gY2MuQ2FtZXJhLmNhbWVyYXM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gY2FtZXJhcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBjYW1lcmEgPSBjYW1lcmFzW2ldO1xuICAgICAgICAgICAgaWYgKGNhbWVyYSA9PT0gdGhpcy51aUNhbWVyYSkge1xuICAgICAgICAgICAgICAgIGNhbWVyYS5jdWxsaW5nTWFzayA9IDEgPDwgdGhpcy5ub2RlLmdyb3VwSW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYW1lcmEuY3VsbGluZ01hc2sgPSBjYW1lcmEuY3VsbGluZ01hc2sgJiAofigxIDw8IHRoaXMubm9kZS5ncm91cEluZGV4KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYmFja1RvTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvYWRTY2VuZShNYWluU2NlbmUpO1xuICAgIH0sXG5cbiAgICBsb2FkU2NlbmU6IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzTG9hZGluZ1NjZW5lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzdWx0ID0gY2MuZGlyZWN0b3IubG9hZFNjZW5lKHVybCwgdGhpcy5vbkxvYWRTY2VuZUZpbmlzaC5iaW5kKHRoaXMpKTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcmFnZS5zZXRDdXJyZW50U2NlbmUoJycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faXNMb2FkaW5nU2NlbmUgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMuc2hvd1JlYWRtZShudWxsLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuY29udGVudFBvcyA9IHRoaXMudGVzdExpc3QuZ2V0Q29udGVudFBvc2l0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmVVcmwgPSB1cmw7XG5cblxuICAgICAgICBpZiAodHlwZW9mIGNvY29zQW5hbHl0aWNzICE9PSAndW5kZWZpbmVkJyAmJiBjb2Nvc0FuYWx5dGljcy5pc0luaXRlZCAmJiBjb2Nvc0FuYWx5dGljcy5pc0luaXRlZCgpKSB7XG4gICAgICAgICAgICAvLyBDb2NvcyBBbmFseXRpY3Mgc2VydmljZSwgdG8gbGVhcm4gbW9yZSBwbGVhc2UgdmlzaXQ6XG4gICAgICAgICAgICAvLyBodHRwczovL2FuYWx5dGljcy5jb2Nvcy5jb20vZG9jcy9cbiAgICAgICAgICAgIGNvY29zQW5hbHl0aWNzLkNBTGV2ZWxzLmJlZ2luKHtcbiAgICAgICAgICAgICAgICBsZXZlbDogdXJsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkxvYWRTY2VuZUZpbmlzaDogZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgdXJsID0gdGhpcy5jdXJyZW50U2NlbmVVcmw7XG4gICAgICAgIHRoaXMubG9hZEluc3RydWN0aW9uKHVybCk7XG4gICAgICAgIC8vIHJlY29yZCB0aGUgbGFzdCBjbG9zZSBzY2VuZSBcbiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEN1cnJlbnRTY2VuZSh1cmwpO1xuXG4gICAgICAgIHRoaXMudGVzdExpc3Qubm9kZS5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICBsZXQgaXNNZW51ID0gdXJsLmVuZHNXaXRoKE1haW5TY2VuZSk7XG4gICAgICAgIHRoaXMuYnRuQmFjay5ub2RlLmFjdGl2ZSA9IHRoaXMuc2NlbmVUaXRsZS5ub2RlLmFjdGl2ZSA9ICFpc01lbnU7XG4gICAgICAgIHRoaXMudGVzdExpc3Qubm9kZS5hY3RpdmUgPSBpc01lbnU7XG4gICAgICAgIGlmIChpc01lbnUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRQb3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRlc3RMaXN0LnNldENvbnRlbnRQb3NpdGlvbih0aGlzLmNvbnRlbnRQb3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zY2VuZVRpdGxlLnN0cmluZyA9IHVybC5yZXBsYWNlKCdkYjovL2Fzc2V0cy9jYXNlcy8nLCAnJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9pc0xvYWRpbmdTY2VuZSA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBfZ2V0QWRqYWNlbnRTY2VuZXMgKCkge1xuICAgICAgICBsZXQgcmVzID0geyBuZXh0OiAnJywgcHJldjogJycgfTtcbiAgICAgICAgbGV0IHNjZW5lTGlzdCA9IHRoaXMuc2NlbmVMaXN0LnNjZW5lTGlzdDtcblxuICAgICAgICBmdW5jdGlvbiBmaW5kQXZhaWxhYmxlU2NlbmUgKHN0YXJ0SW5kZXgsIHN0ZXApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4OyAwIDw9IGkgJiYgaSA8IHNjZW5lTGlzdC5sZW5ndGg7IGkgKz0gc3RlcCkge1xuICAgICAgICAgICAgICAgIGxldCB1cmwgPSBzY2VuZUxpc3RbaV0udXJsO1xuICAgICAgICAgICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNjZW5lTmFtZSA9IGNjLnBhdGguYmFzZW5hbWUodXJsLCAnLmZpcmUnKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGF2YWlsYWJsZSA9IFRpcHNNYW5hZ2VyLmhhc1N1cHBvcnQoc2NlbmVOYW1lLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF2YWlsYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBNYWluU2NlbmU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50U2NlbmVVcmwuZW5kc1dpdGgoTWFpblNjZW5lKSkge1xuICAgICAgICAgICAgcmVzLm5leHQgPSBmaW5kQXZhaWxhYmxlU2NlbmUoMCwgMSk7XG4gICAgICAgICAgICByZXMucHJldiA9IGZpbmRBdmFpbGFibGVTY2VuZShzY2VuZUxpc3QubGVuZ3RoIC0gMSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZmluZEluZGV4XG4gICAgICAgICAgICBsZXQgaSA9IC0xO1xuICAgICAgICAgICAgc2NlbmVMaXN0LnNvbWUoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udXJsID09PSB0aGlzLmN1cnJlbnRTY2VuZVVybCkge1xuICAgICAgICAgICAgICAgICAgICBpID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmVzLm5leHQgPSBmaW5kQXZhaWxhYmxlU2NlbmUoaSArIDEsIDEpO1xuICAgICAgICAgICAgICAgIHJlcy5wcmV2ID0gZmluZEF2YWlsYWJsZVNjZW5lKGkgLSAxLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9LFxuXG4gICAgbmV4dFNjZW5lICgpIHtcbiAgICAgICAgbGV0IHsgbmV4dCB9ID0gdGhpcy5fZ2V0QWRqYWNlbnRTY2VuZXMoKTtcbiAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFNjZW5lKG5leHQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHByZXZTY2VuZSAoKSB7XG4gICAgICAgIGxldCB7IHByZXYgfSA9IHRoaXMuX2dldEFkamFjZW50U2NlbmVzKCk7XG4gICAgICAgIGlmIChwcmV2KSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRTY2VuZShwcmV2KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsb2FkSW5zdHJ1Y3Rpb246IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICBsZXQgdXJsQXJyID0gdXJsLnNwbGl0KCcvJyk7XG4gICAgICAgIGxldCBmaWxlTmFtZSA9IHVybEFyclt1cmxBcnIubGVuZ3RoIC0gMV0ucmVwbGFjZSgnLmZpcmUnLCAnJyk7XG4gICAgICAgIGNjLnJlc291cmNlcy5sb2FkKCdyZWFkbWUvJyArIGZpbGVOYW1lLCBjYy5UZXh0QXNzZXQsIGZ1bmN0aW9uIChlcnIsIGFzc2V0KSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgc2VsZi50ZXh0LnN0cmluZyA9IGkxOG4udChcInNjcmlwdHMvR2xvYmFsL01lbnUuanMuMVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLnRleHQuc3RyaW5nID0gYXNzZXQudGV4dDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNob3dSZWFkbWU6IGZ1bmN0aW9uIChldmVudCwgYWN0aXZlKSB7XG4gICAgICAgIGlmIChhY3RpdmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgYWN0aXZlID0gIXRoaXMucmVhZG1lLm5vZGUuYWN0aXZlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWFkbWUubm9kZS5hY3RpdmUgPSBhY3RpdmU7XG4gICAgICAgIGlmIChhY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMucmVhZG1lLnNjcm9sbFRvVG9wKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlbjogZml4IENvbGxpZGVyIERlYnVnRHJhdyBhbHdheXMgZGlzcGxheWVkIG9uIHRvcCBvZiB0aGUgcHJvYmxlbS5cbiAgICAgICAgLy8gemjvvJrop6PlhrMgQ29sbGlkZXIgRGVidWdEcmF3IOS4gOebtOaYvuekuuWcqOacgOS4iuWxgueahOmXrumimOOAglxuICAgICAgICB2YXIgZW5hYmxlZERlYnVnRHJhdyA9IGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkRGVidWdEcmF3O1xuICAgICAgICBpZiAodGhpcy5yZWFkbWUubm9kZS5hY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd0RlYnVnRHJhdyA9IGVuYWJsZWREZWJ1Z0RyYXc7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5nZXRDb2xsaXNpb25NYW5hZ2VyKCkuZW5hYmxlZERlYnVnRHJhdyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2MuZGlyZWN0b3IuZ2V0Q29sbGlzaW9uTWFuYWdlcigpLmVuYWJsZWREZWJ1Z0RyYXcgPSB0aGlzLnNob3dEZWJ1Z0RyYXc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlbjogZml4IFZpZGVvIFBsYXllciBhbHdheXMgZGlzcGxheWVkIG9uIHRvcCBvZiB0aGUgcHJvYmxlbS5cbiAgICAgICAgLy8gemjvvJrkv67lpI0gVmlkZW8gUGxheWVyIOS4gOebtOaYvuekuuWcqOacgOS4iuWxgueahOmXrumimOOAglxuICAgICAgICB2YXIgdmlkZW9QbGF5ZXIgPSBjYy5maW5kKCdDYW52YXMvVmlkZW9QbGF5ZXInKTtcbiAgICAgICAgaWYgKHZpZGVvUGxheWVyKSB7XG4gICAgICAgICAgICB2aWRlb1BsYXllci5hY3RpdmUgPSAhdGhpcy5yZWFkbWUubm9kZS5hY3RpdmU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVzdGFydCAoKSB7XG4gICAgICAgIGNjLmdhbWUucmVzdGFydCgpO1xuICAgIH0sXG4gICAgXG4gICAgZ2MgKCkge1xuICAgICAgICBjYy5zeXMuZ2FyYmFnZUNvbGxlY3QoKTtcbiAgICB9LFxufSk7XG4iXX0=