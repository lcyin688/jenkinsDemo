
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/cases/collider/Platform/HeroControl.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '339d2dg1QpEKKxBJBzHiDJ0', 'HeroControl');
// cases/collider/Platform/HeroControl.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    speed: cc.v2(0, 0),
    maxSpeed: cc.v2(2000, 2000),
    gravity: -1000,
    drag: 1000,
    direction: 0,
    jumpSpeed: 300,
    _lastSpeedY: 0
  },
  // use this for initialization
  onLoad: function onLoad() {
    //add keyboard input listener to call turnLeft and turnRight
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyPressed, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyReleased, this);
    this.collisionX = 0;
    this.collisionY = 0;
    this.jumping = true;
    this.prePosition = cc.v2();
    this.preStep = cc.v2();
    this.touchingNumber = 0;
  },
  onEnable: function onEnable() {
    cc.director.getCollisionManager().enabled = true;
    cc.director.getCollisionManager().enabledDebugDraw = true;
  },
  onDisable: function onDisable() {
    cc.director.getCollisionManager().enabled = false;
    cc.director.getCollisionManager().enabledDebugDraw = false;
  },
  onKeyPressed: function onKeyPressed(event) {
    var keyCode = event.keyCode;

    switch (keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        this.direction = -1;
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this.direction = 1;
        break;

      case cc.macro.KEY.w:
      case cc.macro.KEY.up:
        if (!this.jumping) {
          this.jumping = true;
          this.speed.y = this.jumpSpeed > this.maxSpeed.y ? this.maxSpeed.y : this.jumpSpeed;
          this._lastSpeedY = this.jumpSpeed > this.maxSpeed.y ? this.maxSpeed.y : this.jumpSpeed;
        }

        break;
    }
  },
  onKeyReleased: function onKeyReleased(event) {
    var keyCode = event.keyCode;

    switch (keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this.direction = 0;
        break;
    }
  },
  onCollisionEnter: function onCollisionEnter(other, self) {
    this.node.color = cc.Color.RED;
    this.touchingNumber++; // 1st step 
    // get pre aabb, go back before collision

    var otherAabb = other.world.aabb;
    var otherPreAabb = other.world.preAabb.clone();
    var selfAabb = self.world.aabb;
    var selfPreAabb = self.world.preAabb.clone(); // 2nd step
    // forward x-axis, check whether collision on x-axis

    selfPreAabb.x = selfAabb.x;
    otherPreAabb.x = otherAabb.x;

    if (cc.Intersection.rectRect(selfPreAabb, otherPreAabb)) {
      if (this.speed.x < 0 && selfPreAabb.xMax > otherPreAabb.xMax) {
        this.node.x = otherPreAabb.xMax - this.node.parent.x;
        this.collisionX = -1;
      } else if (this.speed.x > 0 && selfPreAabb.xMin < otherPreAabb.xMin) {
        this.node.x = otherPreAabb.xMin - selfPreAabb.width - this.node.parent.x;
        this.collisionX = 1;
      }

      this.speed.x = 0;
      other.touchingX = true;
      return;
    } // 3rd step
    // forward y-axis, check whether collision on y-axis


    selfPreAabb.y = selfAabb.y;
    otherPreAabb.y = otherAabb.y;

    if (cc.Intersection.rectRect(selfPreAabb, otherPreAabb)) {
      if (this.speed.y < 0 && selfPreAabb.yMax > otherPreAabb.yMax) {
        this.node.y = otherPreAabb.yMax - this.node.parent.y;
        this.jumping = false;
        this.collisionY = -1;
      } else if (this.speed.y > 0 && selfPreAabb.yMin < otherPreAabb.yMin) {
        this.node.y = otherPreAabb.yMin - selfPreAabb.height - this.node.parent.y;
        this.collisionY = 1;
      }

      this.speed.y = 0;
      this._lastSpeedY = 0;
      other.touchingY = true;
    }
  },
  onCollisionStay: function onCollisionStay(other, self) {
    if (this.collisionY === -1) {
      if (other.node.group === 'Platform') {
        var motion = other.node.getComponent('PlatformMotion');

        if (motion) {
          this.node.x += motion._movedDiff;
        }
      } // this.node.y = other.world.aabb.yMax;
      // var offset = cc.v2(other.world.aabb.x - other.world.preAabb.x, 0);
      // var temp = cc.affineTransformClone(self.world.transform);
      // temp.tx = temp.ty = 0;
      // offset = cc.pointApplyAffineTransform(offset, temp);
      // this.node.x += offset.x;

    }
  },
  onCollisionExit: function onCollisionExit(other) {
    this.touchingNumber--;

    if (this.touchingNumber === 0) {
      this.node.color = cc.Color.WHITE;
    }

    if (other.touchingX) {
      this.collisionX = 0;
      other.touchingX = false;
    } else if (other.touchingY) {
      other.touchingY = false;
      this.collisionY = 0;
      this.jumping = true;
    }
  },
  update: function update(dt) {
    if (this.jumping) {
      this.speed.y += this.gravity * dt;

      if (Math.abs(this.speed.y) > this.maxSpeed.y) {
        this.speed.y = this.speed.y > 0 ? this.maxSpeed.y : -this.maxSpeed.y;
      }
    }

    if (this.direction === 0) {
      if (this.speed.x > 0) {
        this.speed.x -= this.drag * dt;
        if (this.speed.x <= 0) this.speed.x = 0;
      } else if (this.speed.x < 0) {
        this.speed.x += this.drag * dt;
        if (this.speed.x >= 0) this.speed.x = 0;
      }
    } else {
      this.speed.x += (this.direction > 0 ? 1 : -1) * this.drag * dt;

      if (Math.abs(this.speed.x) > this.maxSpeed.x) {
        this.speed.x = this.speed.x > 0 ? this.maxSpeed.x : -this.maxSpeed.x;
      }
    }

    if (this.speed.x * this.collisionX > 0) {
      this.speed.x = 0;
    }

    this.prePosition.x = this.node.x;
    this.prePosition.y = this.node.y;
    this.preStep.x = this.speed.x * dt;
    this.preStep.y = this.speed.y * dt;
    this.node.x += this.speed.x * dt;

    if (this._lastSpeedY === 0 || this.speed.y === 0 || this._lastSpeedY / Math.abs(this._lastSpeedY) === this.speed.y / Math.abs(this.speed.y)) {
      this.node.y += (this._lastSpeedY + this.speed.y) * dt / 2;
    } else {
      this.node.y += -this._lastSpeedY / this.gravity / 2 * this._lastSpeedY + this.speed.y / this.gravity / 2 * this.speed.y;
    }

    this._lastSpeedY = this.speed.y;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9jYXNlcy9jb2xsaWRlci9QbGF0Zm9ybS9IZXJvQ29udHJvbC5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsInNwZWVkIiwidjIiLCJtYXhTcGVlZCIsImdyYXZpdHkiLCJkcmFnIiwiZGlyZWN0aW9uIiwianVtcFNwZWVkIiwiX2xhc3RTcGVlZFkiLCJvbkxvYWQiLCJzeXN0ZW1FdmVudCIsIm9uIiwiU3lzdGVtRXZlbnQiLCJFdmVudFR5cGUiLCJLRVlfRE9XTiIsIm9uS2V5UHJlc3NlZCIsIktFWV9VUCIsIm9uS2V5UmVsZWFzZWQiLCJjb2xsaXNpb25YIiwiY29sbGlzaW9uWSIsImp1bXBpbmciLCJwcmVQb3NpdGlvbiIsInByZVN0ZXAiLCJ0b3VjaGluZ051bWJlciIsIm9uRW5hYmxlIiwiZGlyZWN0b3IiLCJnZXRDb2xsaXNpb25NYW5hZ2VyIiwiZW5hYmxlZCIsImVuYWJsZWREZWJ1Z0RyYXciLCJvbkRpc2FibGUiLCJldmVudCIsImtleUNvZGUiLCJtYWNybyIsIktFWSIsImEiLCJsZWZ0IiwiZCIsInJpZ2h0IiwidyIsInVwIiwieSIsIm9uQ29sbGlzaW9uRW50ZXIiLCJvdGhlciIsInNlbGYiLCJub2RlIiwiY29sb3IiLCJDb2xvciIsIlJFRCIsIm90aGVyQWFiYiIsIndvcmxkIiwiYWFiYiIsIm90aGVyUHJlQWFiYiIsInByZUFhYmIiLCJjbG9uZSIsInNlbGZBYWJiIiwic2VsZlByZUFhYmIiLCJ4IiwiSW50ZXJzZWN0aW9uIiwicmVjdFJlY3QiLCJ4TWF4IiwicGFyZW50IiwieE1pbiIsIndpZHRoIiwidG91Y2hpbmdYIiwieU1heCIsInlNaW4iLCJoZWlnaHQiLCJ0b3VjaGluZ1kiLCJvbkNvbGxpc2lvblN0YXkiLCJncm91cCIsIm1vdGlvbiIsImdldENvbXBvbmVudCIsIl9tb3ZlZERpZmYiLCJvbkNvbGxpc2lvbkV4aXQiLCJXSElURSIsInVwZGF0ZSIsImR0IiwiTWF0aCIs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S0FBS0gsS0FBTCxDQUFXdUMsQ0FBeEg7SUFDSDs7SUFFRCxLQUFLaEMsV0FBTCxHQUFtQixLQUFLUCxLQUFMLENBQVd1QyxDQUE5QjtFQUNIO0FBbk5JLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHNwZWVkOiBjYy52MigwLCAwKSxcbiAgICAgICAgbWF4U3BlZWQ6IGNjLnYyKDIwMDAsIDIwMDApLFxuICAgICAgICBncmF2aXR5OiAtMTAwMCxcbiAgICAgICAgZHJhZzogMTAwMCxcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICBqdW1wU3BlZWQ6IDMwMCxcbiAgICAgICAgX2xhc3RTcGVlZFk6IDBcbiAgICB9LFxuXG4gICAgLy8gdXNlIHRoaXMgZm9yIGluaXRpYWxpemF0aW9uXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vYWRkIGtleWJvYXJkIGlucHV0IGxpc3RlbmVyIHRvIGNhbGwgdHVybkxlZnQgYW5kIHR1cm5SaWdodFxuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vbihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIHRoaXMub25LZXlQcmVzc2VkLCB0aGlzKTtcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVJlbGVhc2VkLCB0aGlzKTtcblxuICAgICAgICB0aGlzLmNvbGxpc2lvblggPSAwO1xuICAgICAgICB0aGlzLmNvbGxpc2lvblkgPSAwO1xuICAgICAgICB0aGlzLmp1bXBpbmcgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMucHJlUG9zaXRpb24gPSBjYy52MigpO1xuICAgICAgICB0aGlzLnByZVN0ZXAgPSBjYy52MigpO1xuXG4gICAgICAgIHRoaXMudG91Y2hpbmdOdW1iZXIgPSAwO1xuICAgIH0sXG5cbiAgICBvbkVuYWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5kaXJlY3Rvci5nZXRDb2xsaXNpb25NYW5hZ2VyKCkuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkRGVidWdEcmF3ID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgb25EaXNhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkRGVidWdEcmF3ID0gZmFsc2U7XG4gICAgfSxcbiAgICBcbiAgICBvbktleVByZXNzZWQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBsZXQga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICAgIHN3aXRjaChrZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5hOlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkubGVmdDpcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IC0xO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuZDpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnJpZ2h0OlxuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnc6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS51cDpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuanVtcGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmp1bXBpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWVkLnkgPSB0aGlzLmp1bXBTcGVlZCA+IHRoaXMubWF4U3BlZWQueSA/IHRoaXMubWF4U3BlZWQueSA6IHRoaXMuanVtcFNwZWVkOyAgICBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdFNwZWVkWSA9IHRoaXMuanVtcFNwZWVkID4gdGhpcy5tYXhTcGVlZC55ID8gdGhpcy5tYXhTcGVlZC55IDogdGhpcy5qdW1wU3BlZWQ7ICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgb25LZXlSZWxlYXNlZDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGxldCBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICAgICAgc3dpdGNoKGtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmE6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5sZWZ0OlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuZDpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnJpZ2h0OlxuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgb25Db2xsaXNpb25FbnRlcjogZnVuY3Rpb24gKG90aGVyLCBzZWxmKSB7XG4gICAgICAgIHRoaXMubm9kZS5jb2xvciA9IGNjLkNvbG9yLlJFRDtcblxuICAgICAgICB0aGlzLnRvdWNoaW5nTnVtYmVyICsrO1xuICAgICAgICBcbiAgICAgICAgLy8gMXN0IHN0ZXAgXG4gICAgICAgIC8vIGdldCBwcmUgYWFiYiwgZ28gYmFjayBiZWZvcmUgY29sbGlzaW9uXG4gICAgICAgIHZhciBvdGhlckFhYmIgPSBvdGhlci53b3JsZC5hYWJiO1xuICAgICAgICB2YXIgb3RoZXJQcmVBYWJiID0gb3RoZXIud29ybGQucHJlQWFiYi5jbG9uZSgpO1xuXG4gICAgICAgIHZhciBzZWxmQWFiYiA9IHNlbGYud29ybGQuYWFiYjtcbiAgICAgICAgdmFyIHNlbGZQcmVBYWJiID0gc2VsZi53b3JsZC5wcmVBYWJiLmNsb25lKCk7XG5cbiAgICAgICAgLy8gMm5kIHN0ZXBcbiAgICAgICAgLy8gZm9yd2FyZCB4LWF4aXMsIGNoZWNrIHdoZXRoZXIgY29sbGlzaW9uIG9uIHgtYXhpc1xuICAgICAgICBzZWxmUHJlQWFiYi54ID0gc2VsZkFhYmIueDtcbiAgICAgICAgb3RoZXJQcmVBYWJiLnggPSBvdGhlckFhYmIueDtcblxuICAgICAgICBpZiAoY2MuSW50ZXJzZWN0aW9uLnJlY3RSZWN0KHNlbGZQcmVBYWJiLCBvdGhlclByZUFhYmIpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zcGVlZC54IDwgMCAmJiAoc2VsZlByZUFhYmIueE1heCA+IG90aGVyUHJlQWFiYi54TWF4KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS54ID0gb3RoZXJQcmVBYWJiLnhNYXggLSB0aGlzLm5vZGUucGFyZW50Lng7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25YID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnNwZWVkLnggPiAwICYmIChzZWxmUHJlQWFiYi54TWluIDwgb3RoZXJQcmVBYWJiLnhNaW4pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnggPSBvdGhlclByZUFhYmIueE1pbiAtIHNlbGZQcmVBYWJiLndpZHRoIC0gdGhpcy5ub2RlLnBhcmVudC54O1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uWCA9IDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc3BlZWQueCA9IDA7XG4gICAgICAgICAgICBvdGhlci50b3VjaGluZ1ggPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gM3JkIHN0ZXBcbiAgICAgICAgLy8gZm9yd2FyZCB5LWF4aXMsIGNoZWNrIHdoZXRoZXIgY29sbGlzaW9uIG9uIHktYXhpc1xuICAgICAgICBzZWxmUHJlQWFiYi55ID0gc2VsZkFhYmIueTtcbiAgICAgICAgb3RoZXJQcmVBYWJiLnkgPSBvdGhlckFhYmIueTtcblxuICAgICAgICBpZiAoY2MuSW50ZXJzZWN0aW9uLnJlY3RSZWN0KHNlbGZQcmVBYWJiLCBvdGhlclByZUFhYmIpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zcGVlZC55IDwgMCAmJiAoc2VsZlByZUFhYmIueU1heCA+IG90aGVyUHJlQWFiYi55TWF4KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS55ID0gb3RoZXJQcmVBYWJiLnlNYXggLSB0aGlzLm5vZGUucGFyZW50Lnk7XG4gICAgICAgICAgICAgICAgdGhpcy5qdW1waW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25ZID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnNwZWVkLnkgPiAwICYmIChzZWxmUHJlQWFiYi55TWluIDwgb3RoZXJQcmVBYWJiLnlNaW4pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnkgPSBvdGhlclByZUFhYmIueU1pbiAtIHNlbGZQcmVBYWJiLmhlaWdodCAtIHRoaXMubm9kZS5wYXJlbnQueTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxpc2lvblkgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLnNwZWVkLnkgPSAwO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFNwZWVkWSA9IDA7XG4gICAgICAgICAgICBvdGhlci50b3VjaGluZ1kgPSB0cnVlO1xuICAgICAgICB9ICAgIFxuICAgICAgICBcbiAgICB9LFxuICAgIFxuICAgIG9uQ29sbGlzaW9uU3RheTogZnVuY3Rpb24gKG90aGVyLCBzZWxmKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbGxpc2lvblkgPT09IC0xKSB7XG4gICAgICAgICAgICBpZiAob3RoZXIubm9kZS5ncm91cCA9PT0gJ1BsYXRmb3JtJykge1xuICAgICAgICAgICAgICAgIHZhciBtb3Rpb24gPSBvdGhlci5ub2RlLmdldENvbXBvbmVudCgnUGxhdGZvcm1Nb3Rpb24nKTtcbiAgICAgICAgICAgICAgICBpZiAobW90aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS54ICs9IG1vdGlvbi5fbW92ZWREaWZmO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdGhpcy5ub2RlLnkgPSBvdGhlci53b3JsZC5hYWJiLnlNYXg7XG5cbiAgICAgICAgICAgIC8vIHZhciBvZmZzZXQgPSBjYy52MihvdGhlci53b3JsZC5hYWJiLnggLSBvdGhlci53b3JsZC5wcmVBYWJiLngsIDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyB2YXIgdGVtcCA9IGNjLmFmZmluZVRyYW5zZm9ybUNsb25lKHNlbGYud29ybGQudHJhbnNmb3JtKTtcbiAgICAgICAgICAgIC8vIHRlbXAudHggPSB0ZW1wLnR5ID0gMDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gb2Zmc2V0ID0gY2MucG9pbnRBcHBseUFmZmluZVRyYW5zZm9ybShvZmZzZXQsIHRlbXApO1xuICAgICAgICAgICAgLy8gdGhpcy5ub2RlLnggKz0gb2Zmc2V0Lng7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIG9uQ29sbGlzaW9uRXhpdDogZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgICAgIHRoaXMudG91Y2hpbmdOdW1iZXIgLS07XG4gICAgICAgIGlmICh0aGlzLnRvdWNoaW5nTnVtYmVyID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm5vZGUuY29sb3IgPSBjYy5Db2xvci5XSElURTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvdGhlci50b3VjaGluZ1gpIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uWCA9IDA7XG4gICAgICAgICAgICBvdGhlci50b3VjaGluZ1ggPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvdGhlci50b3VjaGluZ1kpIHtcbiAgICAgICAgICAgIG90aGVyLnRvdWNoaW5nWSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25ZID0gMDtcbiAgICAgICAgICAgIHRoaXMuanVtcGluZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgaWYgKHRoaXMuanVtcGluZykge1xuICAgICAgICAgICAgdGhpcy5zcGVlZC55ICs9IHRoaXMuZ3Jhdml0eSAqIGR0O1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKHRoaXMuc3BlZWQueSkgPiB0aGlzLm1heFNwZWVkLnkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkLnkgPSB0aGlzLnNwZWVkLnkgPiAwID8gdGhpcy5tYXhTcGVlZC55IDogLXRoaXMubWF4U3BlZWQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3BlZWQueCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkLnggLT0gdGhpcy5kcmFnICogZHQ7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3BlZWQueCA8PSAwKSB0aGlzLnNwZWVkLnggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zcGVlZC54IDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQueCArPSB0aGlzLmRyYWcgKiBkdDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zcGVlZC54ID49IDApIHRoaXMuc3BlZWQueCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNwZWVkLnggKz0gKHRoaXMuZGlyZWN0aW9uID4gMCA/IDEgOiAtMSkgKiB0aGlzLmRyYWcgKiBkdDtcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyh0aGlzLnNwZWVkLngpID4gdGhpcy5tYXhTcGVlZC54KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGVlZC54ID0gdGhpcy5zcGVlZC54ID4gMCA/IHRoaXMubWF4U3BlZWQueCA6IC10aGlzLm1heFNwZWVkLng7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zcGVlZC54ICogdGhpcy5jb2xsaXNpb25YID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zcGVlZC54ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wcmVQb3NpdGlvbi54ID0gdGhpcy5ub2RlLng7XG4gICAgICAgIHRoaXMucHJlUG9zaXRpb24ueSA9IHRoaXMubm9kZS55O1xuXG4gICAgICAgIHRoaXMucHJlU3RlcC54ID0gdGhpcy5zcGVlZC54ICogZHQ7XG4gICAgICAgIHRoaXMucHJlU3RlcC55ID0gdGhpcy5zcGVlZC55ICogZHQ7XG4gICAgICAgIFxuICAgICAgICB0aGlzLm5vZGUueCArPSB0aGlzLnNwZWVkLnggKiBkdDtcbiAgICAgICAgaWYgKHRoaXMuX2xhc3RTcGVlZFkgPT09IDAgfHwgdGhpcy5zcGVlZC55ID09PSAwIHx8IHRoaXMuX2xhc3RTcGVlZFkgLyBNYXRoLmFicyh0aGlzLl9sYXN0U3BlZWRZKSA9PT0gdGhpcy5zcGVlZC55IC8gTWF0aC5hYnModGhpcy5zcGVlZC55KSkge1xuICAgICAgICAgICAgdGhpcy5ub2RlLnkgKz0gKHRoaXMuX2xhc3RTcGVlZFkgKyB0aGlzLnNwZWVkLnkpICogZHQgLyAyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ub2RlLnkgKz0gIC0gdGhpcy5fbGFzdFNwZWVkWSAvIHRoaXMuZ3Jhdml0eSAvIDIgKiB0aGlzLl9sYXN0U3BlZWRZICsgdGhpcy5zcGVlZC55IC8gdGhpcy5ncmF2aXR5IC8gMiAqIHRoaXMuc3BlZWQueTsgXG4gICAgICAgIH0gXG5cbiAgICAgICAgdGhpcy5fbGFzdFNwZWVkWSA9IHRoaXMuc3BlZWQueTtcbiAgICB9LFxufSk7XG4iXX0=