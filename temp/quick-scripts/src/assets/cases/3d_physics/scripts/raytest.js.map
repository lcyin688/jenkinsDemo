{"version":3,"sources":["assets/cases/3d_physics/scripts/raytest.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\n\nenum ERaycastType {\n    ALL,\n    CLOSEST\n}\n\n@ccclass\nexport default class RayTest extends cc.Component {\n\n    @property({ type: cc.Material })\n    defaultMaterial: cc.Material = null;\n\n    @property({ type: cc.Material })\n    rayMaterial: cc.Material = null;\n\n    @property({type:cc.Label})\n    rayState:cc.Label = null;\n\n    private _raycastType: ERaycastType = ERaycastType.ALL;\n    private _maxDistance: number = 100000;\n    private _rayTool: any = null;\n\n    start () {\n        this._rayTool = cc.director.getPhysics3DManager();\n        let canvas = cc.find('Canvas');\n        canvas.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n    }\n\n    switchRay () {\n        if (this._raycastType == ERaycastType.ALL) {\n            this._raycastType = ERaycastType.CLOSEST;\n            this.rayState.string = \"ray close\";\n        } else {\n            this._raycastType = ERaycastType.ALL;\n            this.rayState.string = \"ray all\";\n        }\n    }\n\n    onTouchStart (event) {\n        this.resetAll();\n        let touchLoc = event.touch.getLocation();\n        let ray = cc.Camera.main.getRay(touchLoc);\n        switch (this._raycastType) {\n            case ERaycastType.ALL:\n                const results = this._rayTool.raycast(ray, \"Ball\", this._maxDistance);\n                if (results) {\n                    for (let i = 0; i < results.length; i++) {\n                        const item = results[i];\n                        const modelCom = item.collider.node.getComponent(cc.MeshRenderer);\n                        modelCom.setMaterial(0, this.rayMaterial);\n                        modelCom.markForRender(true);\n                    }\n                }\n                break;\n            case ERaycastType.CLOSEST:\n                const result = this._rayTool.raycastClosest(ray, \"Ball\", this._maxDistance);\n                if (result) {\n                    const modelCom = result.collider.node.getComponent(cc.MeshRenderer);\n                    modelCom.setMaterial(0, this.rayMaterial);\n                    modelCom.markForRender(true);\n                }\n                break;\n        }\n    }\n\n    resetAll () {\n        for (let i = 0; i < this.node.children.length; i++) {\n            if (this.node.children[i].name == 'Sphere2') continue;\n            let mesh = this.node.children[i].getComponent(cc.MeshRenderer);\n            mesh.setMaterial(0, this.defaultMaterial);\n            mesh.markForRender(true);\n        }\n    }\n}\n"]}