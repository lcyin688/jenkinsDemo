{"version":3,"sources":["assets/cases/06_rendering/custom_material/custom_material.js"],"names":["cc","Class","Component","properties","backgroud","Sprite","content","customEffects","EffectAsset","contentTexture","type","Texture2D","gold","speed","_effectIndex","onEnable","originState","dynamicAtlasManager","enabled","onDisable","start","time","bgSpriteMaterial","getMaterial","contentSpriteMaterial","changeEffect","length","newMaterial","Material","newEffect","effectAsset","name","setProperty","setMaterial","update","dt"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE;IACRC,SAAS,EAAEJ,EAAE,CAACK,MADN;IAERC,OAAO,EAAEN,EAAE,CAACK,MAFJ;IAGRE,aAAa,EAAE,CAACP,EAAE,CAACQ,WAAJ,CAHP;IAIRC,cAAc,EAAE;MACZ,WAAS,IADG;MAEZC,IAAI,EAAEV,EAAE,CAACW;IAFG,CAJR;IAQRC,IAAI,EAAE;MACF,WAAS,IADP;MAEFF,IAAI,EAAEV,EAAE,CAACW;IAFP,CARE;IAYRE,KAAK,EAAE,GAZC;IAaRC,YAAY,EAAE;EAbN,CAHP;EAmBL;EAEA;EAEAC,QAvBK,sBAuBO;IACR,KAAKC,WAAL,GAAmBhB,EAAE,CAACiB,mBAAH,CAAuBC,OAA1C;IACAlB,EAAE,CAACiB,mBAAH,CAAuBC,OAAvB,GAAiC,KAAjC;EACH,CA1BI;EA4BLC,SA5BK,uBA4BQ;IACTnB,EAAE,CAACiB,mBAAH,CAAuBC,OAAvB,GAAiC,KAAKF,WAAtC;EACH,CA9BI;EAgCLI,KAhCK,mBAgCI;IACL,KAAKC,IAAL,GAAY,CAAZ;IACA,KAAKC,gBAAL,GAAwB,KAAKlB,SAAL,CAAemB,WAAf,CAA2B,CAA3B,CAAxB;IACA,KAAKC,qBAAL,GAA6B,KAAKlB,OAAL,CAAaiB,WAAb,CAAyB,CAAzB,CAA7B;EACH,CApCI;EAsCLE,YAtCK,0BAsCW;IACZ,KAAKJ,IAAL,GAAY,CAAZ;;IACA,IAAI,KAAKP,YAAL,IAAqB,KAAKP,aAAL,CAAmBmB,MAA5C,EAAoD;MAChD,KAAKZ,YAAL,GAAoB,CAApB;IACH;;IACD,KAAKa,WAAL,GAAmB,IAAI3B,EAAE,CAAC4B,QAAP,EAAnB;IACA,IAAIC,SAAS,GAAG,KAAKtB,aAAL,CAAmB,KAAKO,YAAxB,CAAhB;IACA,KAAKA,YAAL;IACA,KAAKa,WAAL,CAAiBG,WAAjB,GAA+BD,SAA/B;IACA,KAAKF,WAAL,CAAiBI,IAAjB,GAAwBF,SAAS,CAACE,IAAlC;;IACA,IAAIF,SAAS,CAACE,IAAV,KAAmB,iBAAvB,EAA0C;MACtC,KAAKJ,WAAL,CAAiBK,WAAjB,CAA6B,SAA7B,EAAwC,KAAKvB,cAA7C;MACA,KAAKkB,WAAL,CAAiBK,WAAjB,CAA6B,UAA7B,EAAyC,KAAKpB,IAA9C;IACH;;IACD,KAAKN,OAAL,CAAa2B,WAAb,CAAyB,CAAzB,EAA4B,KAAKN,WAAjC;EACH,CArDI;EAuDLO,MAvDK,kBAuDGC,EAvDH,EAuDO;IACR,IAAI,CAAC,KAAKb,gBAAN,IAA0B,CAAC,KAAKE,qBAApC,EAA2D;IAE3D,KAAKH,IAAL,IAAac,EAAE,GAAG,KAAKtB,KAAvB;;IAEA,IAAI,KAAKc,WAAT,EAAsB;MAClB,KAAKA,WAAL,CAAiBK,WAAjB,CAA6B,MAA7B,EAAqC,KAAKX,IAA1C;IACH,CAFD,MAGK;MACD,KAAKG,qBAAL,CAA2BQ,WAA3B,CAAuC,MAAvC,EAA+C,KAAKX,IAApD;IACH;;IACD,KAAKC,gBAAL,CAAsBU,WAAtB,CAAkC,MAAlC,EAA0C,KAAKX,IAAL,GAAY,EAAtD;EACH;AAnEI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        backgroud: cc.Sprite,\n        content: cc.Sprite,\n        customEffects: [cc.EffectAsset],\n        contentTexture: {\n            default: null,\n            type: cc.Texture2D\n        },\n        gold: {\n            default: null,\n            type: cc.Texture2D\n        },\n        speed: 0.1,\n        _effectIndex: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    onEnable () {\n        this.originState = cc.dynamicAtlasManager.enabled;\n        cc.dynamicAtlasManager.enabled = false;\n    },\n\n    onDisable () {\n        cc.dynamicAtlasManager.enabled = this.originState;\n    },\n\n    start () {\n        this.time = 0;\n        this.bgSpriteMaterial = this.backgroud.getMaterial(0);\n        this.contentSpriteMaterial = this.content.getMaterial(0);\n    },\n\n    changeEffect () {\n        this.time = 0;\n        if (this._effectIndex >= this.customEffects.length) {\n            this._effectIndex = 0;\n        }\n        this.newMaterial = new cc.Material();\n        let newEffect = this.customEffects[this._effectIndex];\n        this._effectIndex++;\n        this.newMaterial.effectAsset = newEffect;\n        this.newMaterial.name = newEffect.name;\n        if (newEffect.name === \"custom_material\") {\n            this.newMaterial.setProperty(\"texture\", this.contentTexture);\n            this.newMaterial.setProperty(\"texture2\", this.gold);\n        }\n        this.content.setMaterial(0, this.newMaterial);\n    },\n\n    update (dt) {\n        if (!this.bgSpriteMaterial || !this.contentSpriteMaterial) return;\n\n        this.time += dt * this.speed;\n\n        if (this.newMaterial) {\n            this.newMaterial.setProperty('time', this.time)\n        }\n        else {\n            this.contentSpriteMaterial.setProperty('time', this.time);\n        }\n        this.bgSpriteMaterial.setProperty('time', this.time * 10);\n    },\n});\n"]}