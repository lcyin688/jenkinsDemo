{"version":3,"sources":["assets/cases/05_scripting/10_network/NetworkCtrl.js"],"names":["i18n","require","cc","Class","Component","properties","xhr","Label","xhrAB","xhrTimeout","websocket","socketIO","xhrResp","xhrABResp","xhrTimeoutResp","websocketResp","socketIOResp","wssCacert","type","Asset","_reconnectCount","onLoad","_wsiSendBinary","_xhrXHR","_xhrHRAB","_xhrXHRTimeout","string","t","sendXHR","sendXHRAB","sendXHRTimeout","prepareWebSocket","sendSocketIO","onDisable","wsiSendBinary","onopen","onmessage","onerror","onclose","close","rmXhrEventListener","XMLHttpRequest","streamXHREventsToLabel","open","sys","isNative","setRequestHeader","timeout","send","Uint8Array","self","websocketLabel","respLabel","WebSocket","nativeUrl","binaryType","evt","textKey","binary","Uint16Array","data","binaryStr","str","i","length","hexChar","toString","toUpperCase","String","fromCharCode","scheduleOnce","sendWebSocketBinary","sender","readyState","OPEN","buf","arrData","charCodeAt","buffer","warningStr","testevent","msg","tag","message","disconnection","reconnecting","io","error","sioclient","connect","_sioClient","on","bind","log","eventLabel","label","method","responseHandler","handler","response","substring","eventLabelOrigin","forEach","eventname","onreadystatechange","status","responseText"],"mappings":"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","sourceRoot":"/","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        xhr: cc.Label,\n        xhrAB: cc.Label,\n        xhrTimeout: cc.Label,\n        websocket: cc.Label,\n        socketIO: cc.Label,\n        \n        xhrResp: cc.Label,\n        xhrABResp: cc.Label,\n        xhrTimeoutResp: cc.Label,\n        websocketResp: cc.Label,\n        socketIOResp: cc.Label,\n        wssCacert: {\n            type: cc.Asset,\n            default: null\n        },\n        _reconnectCount: 0,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._wsiSendBinary = null;\n        this._xhrXHR = null;\n        this._xhrHRAB = null;\n        this._xhrXHRTimeout = null;\n        \n        this.xhrResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.1\");\n        this.xhrABResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.2\");\n        this.xhrTimeoutResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.2\");\n        this.websocketResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.3\");\n        this.socketIOResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.4\");\n        \n        this.sendXHR();\n        this.sendXHRAB();\n        this.sendXHRTimeout();\n        this.prepareWebSocket();\n        this.sendSocketIO();\n    },\n\n    onDisable: function () {\n        var wsiSendBinary = this._wsiSendBinary;\n        if (wsiSendBinary) {\n            wsiSendBinary.onopen = null;\n            wsiSendBinary.onmessage = null;\n            wsiSendBinary.onerror = null;\n            wsiSendBinary.onclose = null;\n            wsiSendBinary.close();\n        }\n        this.rmXhrEventListener(this._xhrXHR);\n        this.rmXhrEventListener(this._xhrHRAB);\n        this.rmXhrEventListener(this._xhrXHRTimeout);\n    },\n    \n    sendXHR: function () {\n        var xhr = new XMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhr, this.xhrResp, 'GET');\n\n        xhr.open(\"GET\", \"https://httpbin.org/get?show_env=1\", true);\n        if (cc.sys.isNative) {\n            xhr.setRequestHeader(\"Accept-Encoding\",\"gzip,deflate\");\n        }\n\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\n        // method and before calling the send() method.\n        xhr.timeout = 10000;// 10 seconds for timeout\n\n        xhr.send();\n        this._xhrXHR = xhr;\n    },\n    \n    sendXHRAB: function () {\n        var xhr = new XMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhrAB, this.xhrABResp, \"POST\");\n\n        xhr.open(\"POST\", \"https://httpbin.org/post\");\n        //set Content-type \"text/plain\" to post ArrayBuffer or ArrayBufferView\n        xhr.setRequestHeader(\"Content-Type\",\"text/plain\");\n        // Uint8Array is an ArrayBufferView\n        xhr.send(new Uint8Array([1,2,3,4,5]));\n        this._xhrHRAB = xhr;\n    },\n    \n    sendXHRTimeout: function () {\n        var xhr = new XMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhrTimeout, this.xhrTimeoutResp, 'GET');\n\n        xhr.open(\"GET\", \"https://192.168.22.222\", true);\n\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\n        // method and before calling the send() method.\n        xhr.timeout = 5000;// 5 seconds for timeout\n        xhr.send();\n        this._xhrXHRTimeout = xhr;\n    },\n    \n    prepareWebSocket: function () {\n        var self = this;\n        var websocketLabel = this.websocket;\n        var respLabel = this.websocketResp;\n        // We should pass the cacert to libwebsockets used in native platform, otherwise the wss connection would be closed.\n        this._wsiSendBinary = new WebSocket(\"wss://echo.websocket.org\", [], this.wssCacert.nativeUrl);\n        this._wsiSendBinary.binaryType = \"arraybuffer\";\n        this._wsiSendBinary.onopen = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.5\");\n            respLabel.string = \"Opened!\";\n        };\n\n        this._wsiSendBinary.onmessage = function(evt) {\n            var binary = new Uint16Array(evt.data);\n            var binaryStr = 'response bin msg: ';\n\n            var str = '';\n            for (var i = 0; i < binary.length; i++) {\n                if (binary[i] === 0)\n                {\n                    str += \"\\'\\\\0\\'\";\n                }\n                else\n                {\n                    var hexChar = '0x' + binary[i].toString('16').toUpperCase();\n                    str += String.fromCharCode(hexChar);\n                }\n            }\n\n            binaryStr += str;\n            respLabel.string = binaryStr;\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.6\");\n        };\n\n        this._wsiSendBinary.onerror = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.7\");\n            respLabel.string = \"Error!\";\n        };\n\n        this._wsiSendBinary.onclose = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.8\");\n            // After close, it's no longer possible to use it again, \n            // if you want to send another request, you need to create a new websocket instance\n            self._wsiSendBinary = null;\n            respLabel.string = \"Close!\";\n        };\n        \n        this.scheduleOnce(this.sendWebSocketBinary, 1);\n    },\n\n    sendWebSocketBinary: function(sender) {\n        if (!this._wsiSendBinary) { return; }\n        if (this._wsiSendBinary.readyState === WebSocket.OPEN)\n        {\n            this.websocket.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.9\");\n            var buf = \"Hello WebSocket中文,\\0 I'm\\0 a\\0 binary\\0 message\\0.\";\n            \n            var arrData = new Uint16Array(buf.length);\n            for (var i = 0; i < buf.length; i++) {\n                arrData[i] = buf.charCodeAt(i);\n            }\n            \n            this._wsiSendBinary.send(arrData.buffer);\n        }\n        else\n        {\n            var warningStr = \"send binary websocket instance wasn't ready...\";\n            this.websocket.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.10\") + warningStr;\n            this.scheduleOnce(function () {\n                this.sendWebSocketBinary();\n            }, 1);\n        }\n    },\n\n    // Socket IO callbacks for testing\n    testevent: function(data) {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" says 'testevent' with data: \" + data;\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.11\") + msg;\n    },\n\n    message: function(data) {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" received message: \" + data;\n        this.socketIOResp.string = msg;\n    },\n\n    disconnection: function() {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" disconnected!\";\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.12\") + msg;\n        this.socketIOResp.string = msg;\n    },\n    \n    reconnecting: function () {\n        if (!this.socketIO) { return; }\n\n        this._reconnectCount++;\n        var msg = this.tag + \" is reconnecting(\" + this._reconnectCount + \")\";\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.12\") + msg;\n        this.socketIOResp.string = \"Reconnecting...\";\n    },\n\n    sendSocketIO: function () {\n        var self = this;\n        if (typeof io === 'undefined') {\n            cc.error('You should import the socket.io.js as a plugin!');\n            return;\n        }\n        //create a client by using this static method, url does not need to contain the protocol\n        var sioclient = io.connect(\"ws://tools.itharbors.com:4000\", {\"force new connection\" : true});\n        this._sioClient = sioclient;\n\n        //if you need to track multiple sockets it is best to store them with tags in your own array for now\n        this.tag = sioclient.tag = \"Test Client\";\n        \n        //register event callbacks\n        //this is an example of a handler declared inline\n        sioclient.on(\"connect\", function() {\n            if (!self.socketIO) { return; }\n\n            var msg = sioclient.tag + \" Connected!\";\n            self.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.13\") + msg;\n\n            // Send message after connection\n            self._sioClient.send(\"Hello Socket.IO!\");\n        });\n\n        //example of a handler that is shared between multiple clients\n        sioclient.on(\"message\", this.message.bind(this));\n\n        sioclient.on(\"echotest\", function (data) {\n            if (!self.socketIO) { return; }\n\n            cc.log(\"echotest 'on' callback fired!\");\n            var msg = self.tag + \" says 'echotest' with data: \" + data;\n            self.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.14\") + msg;\n        });\n\n        sioclient.on(\"testevent\", this.testevent.bind(this));\n\n        sioclient.on(\"disconnect\", this.disconnection.bind(this));\n\n        sioclient.on(\"reconnecting\", this.reconnecting.bind(this));\n    },\n    \n    streamXHREventsToLabel: function ( xhr, eventLabel, label, method, responseHandler ) {\n        var handler = responseHandler || function (response) {\n            return method + \" Response (30 chars): \" + response.substring(0, 30) + \"...\";\n        };\n        \n        var eventLabelOrigin = eventLabel.string;\n        // Simple events\n        ['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\n            xhr[\"on\" + eventname] = function () {\n                eventLabel.string = eventLabelOrigin + \"\\nEvent : \" + eventname;\n                if (eventname === 'timeout') {\n                    label.string += '(timeout)';\n                }\n                else if (eventname === 'loadend') {\n                    if (eventname !== '(timeout)') {\n                        label.string += '...loadend!';\n                    }\n                }\n            };\n        });\n    \n        // Special event\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && xhr.status >= 200) {\n                label.string = handler(xhr.responseText);\n            }\n            else if (xhr.status === 404) {\n                label.string = \"404 page not found!\"\n            }\n            else if (xhr.readyState === 3) {\n                label.string = \"Request dealing!\";\n            }\n            else if (xhr.readyState === 2) {\n                label.string = \"Request received!\";\n            }\n            else if (xhr.readyState === 1) {\n                label.string = \"Server connection established! Request hasn't been received\";\n            }\n            else if (xhr.readyState === 0) {\n                label.string = \"Request hasn't been initiated!\";\n            }\n        };\n    },\n\n    rmXhrEventListener: function (xhr) {\n        if (!xhr) {\n            return;\n        }\n        ['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\n            xhr[\"on\" + eventname] = null;\n        });\n        xhr.onreadystatechange = null;\n    }\n});\n"]}