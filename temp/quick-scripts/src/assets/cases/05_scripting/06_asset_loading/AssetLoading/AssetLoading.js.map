{"version":3,"sources":["assets/cases/05_scripting/06_asset_loading/AssetLoading/AssetLoading.js"],"names":["i18n","require","cc","Class","Component","properties","showWindow","Node","loadAnimTestPrefab","Prefab","loadTips","Label","loadList","type","assets","onLoad","_curType","_lastType","_curRes","_btnLabel","_audioSource","_isLoading","_urls","Audio","Txt","Texture","Font","Plist","SpriteFrame","Animation","Scene","Spine","CORS","_onRegisteredEvent","onDestroy","i","length","on","EventType","TOUCH_END","_onClick","bind","event","_onClear","target","name","split","_onShowResClick","textKey","t","getChildByName","getComponent","_load","url","loadCallBack","_loadCallBack","resources","load","sp","SkeletonData","ParticleAsset","loadScene","assetManager","loadRemote","err","res","log","SceneAsset","push","addRef","removeAllChildren","AudioSource","stop","director","runScene","_createNode","node","setPosition","component","addComponent","Sprite","spriteFrame","clip","play","lineHeight","string","font","ParticleSystem","file","resetSystem","prefab","instantiate","parent","loadAnim","AanimCtrl","addClip","Skeleton","skeletonData","animation","y","addChild","forEach","x","decRef"],"mappings":"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","sourceRoot":"/","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        showWindow: cc.Node,\n        loadAnimTestPrefab: cc.Prefab,\n        loadTips: cc.Label,\n        loadList: {\n            default: [],\n            type: cc.Node\n        },\n        assets: [],\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // cur load Target\n        this._curType = \"\";\n        this._lastType = \"\";\n        this._curRes = null;\n        this._btnLabel = null;\n        this._audioSource = null;\n        this._isLoading = false;\n        // add load res url\n        this._urls = {\n            Audio: \"test_assets/audio\",\n            Txt: \"test_assets/text\",\n            Texture: \"test_assets/PurpleMonster\",\n            Font: \"test_assets/font\",\n            Plist: \"test_assets/atom\",\n            SpriteFrame: \"test_assets/image\",\n            Prefab: \"test_assets/prefab\",\n            Animation: \"test_assets/sprite-anim\",\n            Scene: \"test_assets/scene\",\n            Spine: \"spineboy/spineboy\",\n            CORS: \"https://download.cocos.com/test-case/logo.png\",\n        };\n        // registered event\n        this._onRegisteredEvent();\n    },\n\n    onDestroy () {\n\n    },\n\n    _onRegisteredEvent: function () {\n        for (var i = 0; i < this.loadList.length; ++i) {\n            this.loadList[i].on(cc.Node.EventType.TOUCH_END, this._onClick.bind(this));\n        }\n    },\n\n    _onClick: function (event) {\n        if (this._isLoading) {\n            return;\n        }\n\n        this._onClear();\n\n        this._curType = event.target.name.split('_')[1];\n        if (this._lastType !== \"\" && this._curType === this._lastType) {\n            this._onShowResClick(event);\n            return;\n        }\n\n        if (this._btnLabel) {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.1\") + this._lastType;\n        }\n\n        this._lastType = this._curType;\n\n        this._btnLabel = event.target.getChildByName(\"Label\").getComponent(\"cc.Label\");\n\n        this.loadTips.textKey = this._curType + \" Loading....\";\n        this._isLoading = true;\n\n        this._load();\n    },\n\n    _load: function () {\n        var url = this._urls[this._curType];\n        var loadCallBack = this._loadCallBack.bind(this);\n        switch (this._curType) {\n            case 'SpriteFrame':\n                // specify the type to load sub asset from texture's url\n                cc.resources.load(url, cc.SpriteFrame, loadCallBack);\n                break;\n            case 'Spine':\n                // specify the type to avoid the duplicated name from spine atlas\n                cc.resources.load(url, sp.SkeletonData, loadCallBack);\n                break;\n            case 'Font':\n                cc.resources.load(url, cc.Font, loadCallBack);\n                break;\n            case 'Plist':\n                cc.resources.load(url, cc.ParticleAsset, loadCallBack);\n                break;\n            case 'Animation':\n            case 'Prefab':\n            case 'Texture':\n            case 'Txt':\n            case 'Audio':\n                cc.resources.load(url, loadCallBack);\n                break;\n            case 'Scene':\n                cc.resources.loadScene(url, loadCallBack);\n                break;\n            case 'CORS':\n                cc.assetManager.loadRemote(url, loadCallBack);\n                this.loadTips.textKey = \"CORS image should report texImage2D error under WebGL and works ok under Canvas\";\n                break;\n            default:\n                cc.assetManager.loadRemote(url, loadCallBack);\n                break;\n        }\n    },\n\n    _loadCallBack: function (err, res) {\n        this._isLoading = false;\n        if (err) {\n            cc.log('Error url [' + err + ']');\n            return;\n        }\n        if (!(res instanceof cc.SceneAsset)) {\n            this.assets.push(res.addRef());\n        }\n        this._curRes = res;\n        if (this._curType === \"Audio\") {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.2\");\n        }\n        else {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.3\");\n        }\n        this._btnLabel.textKey += this._curType;\n        this.loadTips.textKey = this._curType + \" Loaded Successfully!\";\n    },\n\n    _onClear: function () {\n        this.showWindow.removeAllChildren(true);\n        if (this._audioSource && this._audioSource instanceof cc.AudioSource) {\n            this._audioSource.stop();\n        }\n    },\n\n    _onShowResClick: function (event) {\n        if (this._curType === \"Scene\") {\n            cc.director.runScene(this._curRes);\n\n            return;\n        }\n        this._createNode(this._curType, this._curRes);\n    },\n\n    _createNode: function (type, res) {\n        this.loadTips.textKey = \"\";\n        var node = new cc.Node(\"New \" + type);\n        node.setPosition(0, 0);\n        var component = null;\n        switch (this._curType) {\n            case \"SpriteFrame\":\n                component = node.addComponent(cc.Sprite);\n                component.spriteFrame = res;\n                break;\n            case \"Texture\":\n            case \"CORS\":\n                component = node.addComponent(cc.Sprite);\n                component.spriteFrame = new cc.SpriteFrame(res);\n                break;\n            case \"Audio\":\n                component = node.addComponent(cc.AudioSource);\n                component.clip = res;\n                component.play();\n                this._audioSource = component;\n                this.loadTips.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.4\");\n                break;\n            case \"Txt\":\n                component = node.addComponent(cc.Label);\n                component.lineHeight = 40;\n                component.string = res;\n                break;\n            case \"Font\":\n                component = node.addComponent(cc.Label);\n                component.font = res;\n                component.lineHeight = 40;\n                component.string = \"This is BitmapFont!\";\n                break;\n            case \"Plist\":\n                component = node.addComponent(cc.ParticleSystem);\n                component.file = res;\n                component.resetSystem();\n                break;\n            case \"Prefab\":\n                var prefab = cc.instantiate(res);\n                prefab.parent = node;\n                prefab.setPosition(0, 0);\n                break;\n            case \"Animation\":\n                var loadAnim = cc.instantiate(this.loadAnimTestPrefab);\n                loadAnim.parent = node;\n                loadAnim.setPosition(0, 0);\n                var AanimCtrl = loadAnim.getComponent(cc.Animation);\n                AanimCtrl.addClip(res);\n                AanimCtrl.play(res.name);\n                break;\n            case \"Spine\":\n                component = node.addComponent(sp.Skeleton);\n                component.skeletonData = res;\n                component.animation = \"walk\";\n                node.y = -248;\n                break;\n        }\n        this.showWindow.addChild(node);\n    },\n\n    onDestroy () {\n        this.assets.forEach(x => x.decRef());\n        this.assets = null;\n    }\n});\n"]}