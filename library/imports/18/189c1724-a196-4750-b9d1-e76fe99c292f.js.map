{"version":3,"sources":["assets/cases/03_gameplay/01_player_control/DeviceMotion/DeviceMotionCtrl.js"],"names":["i18n","require","cc","Class","Component","properties","speed","target","Node","btn_label","Label","_time","_range","v2","_acc","onLoad","_enabled","screenSize","view","getVisibleSize","x","width","y","height","systemEvent","on","SystemEvent","EventType","DEVICEMOTION","onDeviceMotionEvent","onOpenAccelerometer","textKey","t","setAccelerometerEnabled","onDestroy","off","event","acc","update","dt","range","misc","clampf"],"mappings":"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","sourceRoot":"/","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        speed: 200,\n        target: cc.Node,\n        btn_label: cc.Label,\n        _time: 0,\n        _range: cc.v2(0, 0),\n        _acc: cc.v2(0, 0)\n    },\n\n    onLoad () {\n        this._enabled = false;\n        var screenSize = cc.view.getVisibleSize();\n        this._range.x = screenSize.width / 2 - this.target.width / 2;\n        this._range.y = screenSize.height / 2 - this.target.height / 2;\n        cc.systemEvent.on(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n    },\n\n    onOpenAccelerometer () {\n        this._enabled = !this._enabled;\n        if (this._enabled) {\n            this.btn_label.textKey = i18n.t('cases/03_gameplay/01_player_control/On/DeviceMotion.fire.2');\n        }\n        else {\n            this.btn_label.textKey = i18n.t('cases/03_gameplay/01_player_control/On/DeviceMotion.fire.1');\n        }\n        if (!this._enabled) {\n            this._acc.x =  0;\n            this._acc.y =  0;\n            this._time = 0;\n        }\n        cc.systemEvent.setAccelerometerEnabled(this._enabled);\n    },\n\n    onDestroy () {\n        cc.systemEvent.setAccelerometerEnabled(false);\n        cc.systemEvent.off(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n    },\n\n    onDeviceMotionEvent (event) {\n        this._acc.x =  event.acc.x;\n        this._acc.y =  event.acc.y;\n    },\n\n    update (dt) {\n        var target = this.target, range = this._range;\n        this._time += 5;\n        target.x += this._acc.x * dt * (this.speed + this._time);\n        target.x = cc.misc.clampf(target.x, -range.x, range.x);\n        target.y += this._acc.y * dt * (this.speed + this._time);\n        target.y = cc.misc.clampf(target.y, -range.y, range.y);\n\n        if (target.x <= -range.x || target.x >= range.x ||\n            target.y <= -range.y || target.y >= range.y) {\n            this._time = 0;\n        }\n    }\n\n});\n"]}