{"version":3,"sources":["assets/cases/02_ui/09_videoplayer/StayOnBottom/stayOnBottomCtrl.js"],"names":["cc","macro","ENABLE_TRANSPARENT_CANVAS","randomNum","min","max","Math","random","TIPS","Class","Component","properties","tempBarrage","Prefab","videoPlayer","VideoPlayer","barrageRoot","Node","tips","start","__id","_animList","node","find","btnPlay","getComponent","Button","interactable","btnPause","btnStop","onCreateBarrage","instantiate","___id","y","parent","r","g","b","color","label","Label","idx","floor","length","string","animComp","Animation","on","destroy","onClearBarrages","_intervalID","clearInterval","keys","Object","i","len","key","anim","onOpenBarrages","setInterval","onPlayAnim","onCloseBarrages","onPauseAnim","getAnimationState","isPaused","resume","play","pause","active","stop"],"mappings":"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","sourceRoot":"/","sourcesContent":["// 开启 Canvas 背景支持 alpha 通道\ncc.macro.ENABLE_TRANSPARENT_CANVAS = true;\n\nfunction randomNum (min, max){\n    return Math.random() * (max - min + 1) + min;\n}\n\nconst TIPS = [\n    '这个是一个范例，该范例是让用户知道如何把 UI 渲染到 VideoPlayer 上',\n    'UI 渲染到 VideoPlayer 上只需三个步骤：1。创建代码开启 cc.macro.ENABLE_TRANSPARENT_CANVAS 2。设置摄像机的背景颜色的透明度为零 3。勾选 VideoPlayer 组件上的 stayOnBottom 属性 -- 就 OK 了',\n    'UI 居然可以显示在 VidePlayer 上面了，👍👍👍👍👍',\n    '哇，可以做弹幕功能了... 💐💐💐💐💐',\n    '哇，可以做约会游戏了... 💐💐💐💐💐',\n    '注意：该功能只支持 web 平台',\n    '注意：该功能的效果在各个浏览器的限制下不能保持效果一致',\n    '我是打酱油的...',\n    'Cococs Creator 是最棒的，不接收反驳...',\n    '前面的说的对...',\n    '其实我也不知道要说什么，反正只是为了充数用而已'\n];\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tempBarrage: cc.Prefab,\n        videoPlayer: cc.VideoPlayer,\n        barrageRoot: cc.Node,\n        tips: cc.Node,\n    },\n\n    start () {\n        this.__id = 0;\n        this._animList = [];\n\n        let node = cc.find('Canvas/Play');\n        this.btnPlay = node.getComponent(cc.Button);\n        this.btnPlay.interactable = true;\n\n        node = cc.find('Canvas/Pause');\n        this.btnPause = node.getComponent(cc.Button);\n        this.btnPause.interactable = false;\n\n        node = cc.find('Canvas/Stop');\n        this.btnStop = node.getComponent(cc.Button);\n        this.btnStop.interactable = false;\n    },\n\n    // 创建弹幕\n    onCreateBarrage () {\n        let node = cc.instantiate(this.tempBarrage);\n        ++this.__id;\n        node.___id = this.__id;\n        node.y = randomNum(300, -120);\n        node.parent = this.node;\n        let r = randomNum(0, 255);\n        let g = randomNum(0, 255);\n        let b = randomNum(0, 255);\n        node.color = cc.color(r, g, b);\n        let label = node.getComponent(cc.Label);\n        let idx = Math.floor(randomNum(0, TIPS.length - 1));\n        label.string = TIPS[idx];\n        let animComp = node.getComponent(cc.Animation);\n        animComp.on('stop', () => {\n            delete this._animList[node.___id];\n            node.destroy();\n        });\n        this._animList[this.__id] = animComp;\n    },\n\n    // 清空弹幕\n    onClearBarrages () {\n        this._intervalID && clearInterval(this._intervalID);\n        let keys = Object.keys(this._animList);\n        for (let i = 0, len = keys.length; i < len; ++i) {\n            let key = keys[i];\n            let anim = this._animList[key];\n            anim.node.destroy();\n        }\n        this._animList.length = 0;\n    },\n\n    // 开启弹幕\n    onOpenBarrages () {\n        this._intervalID = setInterval(() => {\n            this.onCreateBarrage();\n        }, 1000);\n        this.onPlayAnim();\n    },\n\n    // 关闭弹幕\n    onCloseBarrages () {\n        this._intervalID && clearInterval(this._intervalID);\n        this.onPauseAnim();\n    },\n\n    // 播放弹幕动画\n    onPlayAnim () {\n        let keys = Object.keys(this._animList);\n        for (let i = 0, len = keys.length; i < len; ++i) {\n            let key = keys[i];\n            let anim = this._animList[key];\n            if (anim.getAnimationState('barrage-animClip').isPaused) {\n                anim.resume();\n            }\n            else {\n                anim.play();\n            }\n        }\n    },\n\n    // 暂停弹幕动画\n    onPauseAnim () {\n        for (let key in this._animList) {\n            let anim = this._animList[key];\n            anim.pause();\n        }\n    },\n\n    // 播放视频\n    play () {\n        this.tips.active = false;\n        this.btnPlay.interactable = false;\n        this.btnPause.interactable = true;\n        this.btnStop.interactable = true;\n        this.videoPlayer.play();\n        this.onOpenBarrages();\n    },\n\n    // 暂停视频\n    pause () {\n        this.btnPlay.interactable = true;\n        this.btnPause.interactable = false;\n        this.btnStop.interactable = true;\n        this.videoPlayer.pause();\n        this.onCloseBarrages();\n    },\n\n    // 停止视频\n    stop () {\n        this.tips.active = true;\n        this.btnPlay.interactable = true;\n        this.btnPause.interactable = false;\n        this.btnStop.interactable = false;\n        this.videoPlayer.stop();\n        this.onClearBarrages();\n    },\n});\n"]}