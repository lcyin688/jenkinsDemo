{"version":3,"sources":["assets/cases/03_gameplay/01_player_control/OnTouchCtrl/OnTouchCtrl.js"],"names":["i18n","require","cc","Class","Component","properties","canvas","Node","touchLocationDisplay","type","Label","follower","followSpeed","onLoad","self","moveToPos","v2","isMoving","on","EventType","TOUCH_START","event","touches","getTouches","touchLoc","getLocation","parent","convertToNodeSpaceAR","textKey","t","Math","floor","x","y","node","TOUCH_MOVE","TOUCH_END","update","dt","oldPos","position","direction","sub","normalize","newPos","add","mul","setPosition"],"mappings":"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","sourceRoot":"/","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        canvas: cc.Node,\n        touchLocationDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        follower: {\n            default: null,\n            type: cc.Node\n        },\n        followSpeed: 200\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        var self = this;\n        self.moveToPos = cc.v2(0, 0);\n        self.isMoving = false;\n        self.canvas.on(cc.Node.EventType.TOUCH_START, function (event) {\n            var touches = event.getTouches();\n            var touchLoc = touches[0].getLocation();\n            self.isMoving = true;\n            self.moveToPos = self.follower.parent.convertToNodeSpaceAR(touchLoc);\n            self.touchLocationDisplay.textKey = i18n.t(\"cases/03_gameplay/01_player_control/On/OnTouchCtrl.js.1\") + Math.floor(touchLoc.x) + ', ' + Math.floor(touchLoc.y) + ')';\n        }, self.node);\n        self.canvas.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            var touches = event.getTouches();\n            var touchLoc = touches[0].getLocation();\n            self.moveToPos = self.follower.parent.convertToNodeSpaceAR(touchLoc);\n            self.touchLocationDisplay.textKey = i18n.t(\"cases/03_gameplay/01_player_control/On/OnTouchCtrl.js.1\") + Math.floor(touchLoc.x) + ', ' + Math.floor(touchLoc.y) + ')';\n        }, self.node);\n        self.canvas.on(cc.Node.EventType.TOUCH_END, function (event) {\n            self.isMoving = false; // when touch ended, stop moving\n        }, self.node);\n    },\n\n    // called every frame\n    update: function (dt) {\n        if (!this.isMoving) return;\n        var oldPos = this.follower.position;\n        // get move direction\n        var direction = this.moveToPos.sub(oldPos).normalize();\n        // multiply direction with distance to get new position\n        var newPos = oldPos.add(direction.mul(this.followSpeed * dt));\n        // set new position\n        this.follower.setPosition(newPos);\n    }\n});\n"]}